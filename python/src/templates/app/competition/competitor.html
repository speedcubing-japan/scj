{% extends "app/common/base.html" %}
{% load bootstrap4 %}
{% load key %}
{% load result_convert %}
{% load i18n %}

{% block content %}
{% include "app/common/competition_title.html" %}

<div class="row">
  <div class="col-lg-2 mb-3">
    {% include "app/competition/menu.html" with active='competitor' %}
  </div>
  <div class="col-lg-10 mb-3">
    <select class="competition_competitor">
      <option value="{% url 'competition_competitor' competition.name_id 'list' %}" {% if event_id_name == 'list' %}selected{% endif %}>{% trans "全競技者" %}</option>
      {% for event_info in event_infos %}
        <option value="{% url 'competition_competitor' competition.name_id event_info.event_id_name %}" {% if event_id_name == event_info.event_id_name %}selected{% endif %}>{{ event_info.event_name }}</option>
      {% endfor %}
    </select>
    {% if competitors %}
      <div class="mb-3 text-nowrap table-responsive">
        <table id="competitor" class="table table-hover table-striped table-sm">
          <thead>
            <tr>
              {% if competition.type == competition_type.WCA.value %}
                <th scope="col" style="width: 10%;"><i class="fas fa-sort"><span class="ml-2">{% trans "氏名" %}</span></th>
                <th scope="col" style="width: 10%;"><i class="fas fa-sort"><span class="ml-2">{% trans "国籍" %}</span></th>
              {% elif competition.type == competition_type.SCJ.value %}
                <th scope="col" style="width: 10%;"><i class="fas fa-sort"><span class="ml-2">{% trans "氏名" %}</span></th>
                <th scope="col" style="width: 10%;"><i class="fas fa-sort"><span class="ml-2">{% trans "都道府県" %}</span></th>
              {% endif %}
              {% if event_id_name != 'list' and competition.type == competition_type.SCJ.value %}
                <th scope="col"><i class="fas fa-sort"><span class="ml-2">{% trans "ベスト" %}</span></th>
                <th scope="col"><i class="fas fa-sort"><span class="ml-2">{% trans "平均" %}</span></th>
              {% endif %}
            </tr>
          </thead>
          <tbody>
            {% for competitor in competitors %}
              <tr {% if competitor.status == competitor_status.PENDING.value %} class="bg-light"{% endif %}>
                {% if competition.type == competition_type.SCJ.value %}
                  <td>{{ competitor.name }}</td>
                  <td>{{ competitor.prefecture }}</td>
                {% elif competition.type == competition_type.WCA.value %}
                  {% if competitor.person.wca_id %}
                    <td><a href="https://www.worldcubeassociation.org/persons/{{ competitor.person.wca_id }}" target="_blank">{{ competitor.name }}</a></td>
                  {% else %}
                    <td>{{ competitor.name }}</td>
                  {% endif %}
                  {% if request.LANGUAGE_CODE == 'ja' %}
                    <td>{{ competitor.country }}</td>
                  {% else %}
                    <td>{{ competitor.en_country }}</td>
                  {% endif %}
                {% endif %}
                {% if event_id_name != 'list' and competition.type == competition_type.SCJ.value %}
                  <td>{{ competitor.best | result_convert:event_id }}</td>
                  <td>{{ competitor.average | result_convert:event_id }}</td>
                {% endif %}
              </tr>
            {% endfor %}
          </tbody>
          {% if event_id_name == 'list' %}
          <tfoot>
            <tr>
              <td>{% blocktrans with first_timers=competitors_count_info.first_timers returners=competitors_count_info.returners sum=competitors_count_info.sum %}{{ first_timers }} 人 (初参加者) + {{ returners }} 人 (経験者) = {{ sum }} 人{% endblocktrans %}</td>
              {% if competition.type == competition_type.SCJ.value %}
                <td>{% blocktrans with country_count=competitors_count_info.country_count %}{{ country_count}}都道府県{% endblocktrans %}</td>
              {% elif competition.type == competition_type.WCA.value %}
                <td>{% blocktrans with country_count=competitors_count_info.country_count %}{{ country_count}}ヶ国{% endblocktrans %}</td>
              {% endif %}
            </tr>
          </tfoot>
          {% endif %}
        </table>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
